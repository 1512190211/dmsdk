 # 第三方账号方案

TSKM模块中的各个组件，如多端互动组件TVSDeviceControl均支持第三方账号方案，本文档提供了该方案的接入流程。

## 自定义AuthDelegate

TSKM模块在发送请求时需要账号信息，在第三方账号方案下，您需要将账号信息提供给DMSDK，要做到这一点，请实现一个自定义的AuthDelegate，下面给出实现的范例代码：

```java
public class MyAuthDelegate implements AuthDelegate {
    @Override
    public void tvsWXLogin(TVSCallback callback) {
    }

    @Override
    public void tvsWXTokenRefresh(TVSCallback callback) {
    }

    @Override
    public void tvsQQOpenLogin(TVSCallback callback) {
    }

    @Override
    public void tvsLogout() {
    }

    @Override
    public TVSAccountInfo getAccountInfo() {
        TVSAccountInfo accountInfo = new TVSAccountInfo();
        accountInfo.setPlatform(ELoginPlatform.ThirdParty);
        accountInfo.setOpenID("ACCOUNT_ID_FOR_CURRENT_LOGGED_IN_USER");
        return accountInfo;
    }

    @Override
    public TVSUserInfo getUserInfo() {
        return null;
    }

    @Override
    public void tvsSetPhoneNumber(String phoneNumber) {
    }
}
```

您只需要自定义`getAccountInfo`的实现，其他方法均不需要实现，留空即可。对于`getAccountInfo`返回的账号信息，目前您需要且只需要提供platform和openID两个字段，其中登录平台必须是`ELoginPlatform.ThirdParty`，而openID字段为您应用的账号体系中当前登录用户的账号ID，也即在上一个SDK版本中您构造TVSDeviceControl等方法的时候传入的accountId参数。该方案更加灵活，允许您动态决定发送请求的时刻当前用户的ID，同时可拓展性更好。

## 使用自定义AuthDelegate初始化DMSDK

在使用DMSDK的账号体系的时候，我们这样初始化DMSDK：

```java
LoginProxy.getInstance().registerApp(appContext, "WeChatAppId", "QQOpenAppId");
```

而当您需要使用您的账号体系，也即第三方账号体系时，这样初始化：

```java
LoginProxy.getInstance().registerApp(appContext, "", "", mYourCustomAuthDelegate);
```

由于使用了第三方账号，QQ和微信登录的AppID也只需要传入空字符串即可。
