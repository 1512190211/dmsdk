# 常见问题

## 什么时机需要主动触发刷票？

1. APP启动后，在判断已经登录的情况下；
2. 从APP生成并给设备传递ClientId之前；
3. APP调用需要校验票据的接口前。

## 云端绑定有何作用？

云端绑定可以作为服务请求合法性校验的一个重要维度，可为APP提供设备绑定、解绑、绑定关系查询等管理能力，并为推送功能做好基础。

## 如何实现WebView模块网络不通下展示异常UI？

TVSWebView模块不具备网络连通状态监听功能，但可以轻松实现网络异常提醒。

使用Android提供的API监听网络状态：

```java
@Override
protected void onResume() {
    super.onResume();
    IntentFilter filter = new IntentFilter(ConnectivityManager.CONNECTIVITY_ACTION);
    registerReceiver(new BroadcastReceiver() {
        @Override
        public void onReceive(Context context, Intent intent) {
            ConnectivityManager manager = (ConnectivityManager) context.getSystemService(Context.CONNECTIVITY_SERVICE);
            NetworkInfo info = manager.getActiveNetworkInfo();
            boolean connected = info != null && info.isConnectedOrConnecting();
        }
    }, filter);
}
```

详细的实现方式和API可以参考Android[官方文档](https://developer.android.com/training/monitoring-device-state/connectivity-monitoring)。

通过上面代码片段的`connected`可以判断是否连通了网络，在断开的时候可以直接在TVSWebView上方覆盖一层网络不可达的View，而网络重新恢复的时候隐藏该View并调用`com.tencent.ai.tvs.web.TVSWebController#reload()`刷新网页。

除此以外，在`com.tencent.ai.tvs.web.TVSWebController.UIEventListener#onLoadError()`回调中可以监听网页加载失败的事件，可以在此时展示相应的UI。但需要注意TVSWebView默认启用了离线缓存，在网络故障时会默认加载离线缓存，这会导致该回调未被调用，可以通过调用`com.tencent.ai.tvs.web.WebController#setLoadCacheOnDisconnected(boolean)`关闭离线缓存。